---
title : "Slam 3-2강 (ICP & Unknown Data Association) 요약"
category :
    - Slam
tag :
    - Slam
toc : true
toc_sticky: true
comments: true
---

Cyrill 교수님의 SLAM 강의를 듣고 정리해보자!  

## 0. Today's Goal

- ICP 알고리즘이란?  
- Direct Optimal Solution with Known Data Association  
- Why solution used SVD is good?  

## 1. 강의 및 강의 자료  

강의 List는 [SLAM KR](https://www.youtube.com/channel/UCXvT7auo7xUd7v0B2pmvwIA)의 SLAM DUNK seson 2에서 정해준 강의를 따라 정리를 할 것이다.  

SLAM DUNK season 2의 Reference는 [여기](https://youtube.com/playlist?list=PLubUquiqNQdMYwQVftUSFEWhJgzBErO9N)서 확인해 볼 수 있다.  

SLAM KR에서 이 강의를 듣고 요약을 세미나 형식으로 준비를 해준다!

이번 포스팅은 다음의 강의들을 참고하여 요약을 해보았다.  

Point Cloud Registration & ICP의 경우 2021 강의에서 3번에 걸쳐 나눠 강의를 진행했기 때문에  
그 강의를 듣고 요약을 진행했다.  

- [ICP & Point Cloud Registration - Part 2: Unknown Data Association (Cyrill Stachniss, 2021)](https://youtu.be/ktRqKxddjJk)    
- [SLAM DUNK Season 2 - Iterative Closest Points](https://youtu.be/BiQx5ISVdxU)  

Cyrill Stachniss의 강의 자료는 pdf로 [다운](https://drive.google.com/file/d/1J_QCE1CLwJ5d7ugY1wnx-DWNaWR-FQTr/view?usp=sharing) 받을 수 있다.  

## ICP 알고리즘이란?  

[지난 포스팅](https://taeyoung96.github.io/slam/SLAM_03_1/)에 이어서 Point Cloud Registration에 대해서 강의를 진행해주셨다.  

두 Point Cloud 간의 대응관계(Correspondences)가 주어져 있을 때는 SVD 알고리즘을 활용해 Rotation Matrix $R$ 과 Translation Vector $t$를 찾을 수 있었다.  
한장의 슬라이드로 정리하면 다음과 같다.  

<p align="center"><img src="https://user-images.githubusercontent.com/41863759/139383703-45a610be-3aff-473f-acd6-1cfd2403f7f8.png" width = "600" ></p>  

(자세한 내용은 [지난 포스팅](https://taeyoung96.github.io/slam/SLAM_03_1/)을 참고하자.)  

이번 강의에서는 **대응관계(Correspondences)가 주어져 있지 않을 때,  
즉 Unknown Data Association일 때 Point Cloud Registration을 하는 방법에 대해서 알아보자.**  

아쉽게도 Unknown Data Association일 때는 Direct하고 Optimal한 Solution이 존재하지는 않는다.  

그러나 두 Point Cloud Set(집합)의 대응 관계를 잘 추정(Estimate)하고, 그 후 Rotation Matrix $R$ 과 Translation Vector $t$를 찾는 방법으로 Point Cloud Registration을 진행한다면 최적의 해를 찾을 수 있다.  

이것이 ICP Algorithm이다.  
> ICP Algorithm이란 Point Cloud Registration을 진행할 때 Data Association에 대해서 모를 경우,  
대응관계를 추정하고 그 대응관계를 통해 두 Point Cloud를 Align을 하는 과정 중 하나이다.  
대응관계를 만들 때는 가장 가까운 점을 활용하며 반복적인 과정을 통해 오차를 최소화한다.  



<p align="center"><img src="https://user-images.githubusercontent.com/41863759/139392961-9b65fb42-3872-47e0-8b56-0c49ac852a57.png" width = "500" ></p>  

과정을 다시한번 설명하자면,  
Data Association을 추정하고 추정된 Data Association을 활용하여 Rigid body transformation을 구한다.  
이를 반복적으로 수행하여 최적의 Parameter (Rotation matrix & Translation vector)를 찾는다.  

ICP 알고리즘에서는 Direct로 해를 찾을 수 없어 **초기값(Initial guess)을 가정하고 문제를 풀어나간다.**  
예를 들어 Reference frame에서의 point cloud의 위치나 정확하지는 않지만 대략적인 대응관계  
(Correspondences)를 초기값으로 가정한다.  

Point Cloud Set $x_n, y_n$이 있다고 할 때 ICP 알고리즘의 흐름을 대략적으로 설명하면 다음과 같다.  

1. Point Cloud $x_n$의 대략적인 대응관계를 초기값으로 설정한다.  
보통 대응관계를 구할 때는 $x_n$에서 각각의 point에 대해, 가장 가까운 거리에 있는 $y_n$의 하나의 점과 매칭을 통해 대응관계를 만든다.       
2. 대응관계를 활용하여 Rotation Matrix $R$과 Translation vector $t$를 구한다.  
3. $R,t$를 활용하여 다시 $\bar{x_n} = R * x_n + t$ 으로 만들어 $y_n$과 align 시킨다.  
4. $\bar{x_n}$과 $y_n$의 차이를 Error로 정의하고 Error 값이 원하는 Threshold 값보다 적어질 때까지 1~3번 과정을 진행한다.  

❗ICP를 jupyter notebook으로 작성한 [링크](https://nbviewer.org/github/niosus/notebooks/blob/master/icp.ipynb#Overview)가 있는데 Visualize도 굉장히 잘 되어있다!  

**위와 같은 ICP를 Vanila ICP라고 부른다. 즉, 가장 기본이 되는 ICP Algorithm이다.**  

Vanila ICP의 경우 구현이 간단하지만 몇 가지 단점들이 존재한다.  

1. Iteration이 많이 필요할 수도 있다. 즉, iteration과 비례하여 시간이 오래 걸릴 수 있다.  

2. 초기 대응관계(Correspondences)를 완전히 잘못 구하거나  
나쁜 대응관계(Correspondences)를 이용할 경우 결과가 매우 나쁠 수 있다.  

따라서 이러한 단점들을 보완하려는 연구들이 많이 진행되었고,  
ICP Algorithm은 다음과 같은 내용들에 Focus를 맞추어 연구가 진행되었다.  

- 전체 Point Cloud가 아닌 부분적인 Point Cloud (points subset)만 사용  
- 또 다른 Data Association 전략을 사용  
- 가중치가 부여된 대응관계(Weight the Correspondences)를 활용  
- Outlier를 제거 후 point pairs를 맞추는 방법  

좀 더 발전된 ICP 알고리즘에 대해서 한 번 알아보자.  