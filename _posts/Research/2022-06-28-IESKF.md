---
title : "IESKF(Iterated error state Kalman Filter)ì´ë€ ë¬´ì—‡ì¼ê¹Œ?"
category :
    - Research
tag :
    - IESKF  
    - Filter
toc : true
toc_sticky: true
comments: true
---  

Iterated error state Kalman Filterì— ëŒ€í•œ ì„¤ëª…ì„ ê°„ëµí•˜ê²Œ í¬ìŠ¤íŒ…í•´ë³´ì.  

ìµœê·¼ LiDAR-inertial Odometry ë° SLAMì„ ê³µë¶€í•˜ë˜ ë„ì¤‘, FAST-LIO ì‹œë¦¬ì¦ˆê°€ ì£¼ëª©ì„ ë°›ê³  ìˆëŠ” ê²ƒì„ ì•Œ ìˆ˜ ìˆì—ˆë‹¤. ì†ŒìŠ¤ì½”ë“œë„ ë‹¤ ê³µê°œê°€ ë˜ì–´ ìˆê³ , ìµœê·¼ì— ì§„í–‰ëœ SLAM ëŒ€íšŒì¸ [HILTI SLAM Challenge 2022ì˜ solution](https://hilti-challenge.com/leader-board-2022.html)ì„ ì‚´í´ë³´ë©´ ëŒ€ë¶€ë¶„ baselineì„ FAST-LIO ì‹œë¦¬ì¦ˆë¡œ ì¡ê³  ê°€ëŠ” ê²ƒë„ í™•ì¸í–ˆë‹¤. (ë§í¬ë¥¼ íƒ€ê³  ë“¤ì–´ê°€ì„œ íŒ€ì´ë¦„ì„ ëˆ„ë¥´ë©´ ê°„ë‹¨í•œ ë ˆí¬íŠ¸ë¥¼ í™•ì¸í•  ìˆ˜ ìˆë‹¤!)  

FAST-LIO ì‹œë¦¬ì¦ˆëŠ” ìµœì í™” ë°©ì‹ì„ Filter-basedë¡œ í’€ì–´ê°€ëŠ”ë° ì—¬ê¸°ì„œ ì‚¬ìš©í•˜ëŠ” Filterì˜ ë°©ì‹ì´ ë°”ë¡œ **IESKF(Iterated error state Kalman Filter)**ì´ë‹¤.  

ë”°ë¼ì„œ ì´ë²ˆ í¬ìŠ¤íŒ…ì—ì„œëŠ” IESKF(Iterated error state Kalman Filter)ê°€ ì–´ë–¤ ê²ƒì´ê³  ê¸°ì¡´ì— ìˆë˜ Filter ë°©ì‹ë³´ë‹¤ ì–´ë–¤ ì¥ì ì´ ìˆëŠ”ì§€ ê°„ë‹¨í•˜ê²Œ í¬ìŠ¤íŒ…í•˜ê³ ì í•œë‹¤.  

ìš°ì„  ì´ë²ˆ í¬ìŠ¤íŒ…ì€ Kalman Filter, Extended Kalman Filterë“± ì—¬ëŸ¬ Filterë¥¼ ì•Œê³  ìˆë‹¤ëŠ” ì „ì œí•˜ì— ì‘ì„±ë˜ì—ˆë‹¤.  

EKFì— ëŒ€í•œ ì§€ì‹ì´ ë¶€ì¡±í•˜ë‹¤ë©´ ì•„ë˜ì˜ í¬ìŠ¤íŒ…ì„ ì°¸ê³ í•´ë³´ì.  
- [Slam 7ê°• (Kalman Filter & EKF) ìš”ì•½](https://taeyoung96.github.io/slam/SLAM_07/)  
- [[SLAM] Kalman filter and EKF(Extended Kalman Filter)](http://jinyongjeong.github.io/2017/02/14/lec03_kalman_filter_and_EKF/)  

## Error state Kalman Filterë€?  

IESKF(Iterated error state Kalman Filter)ë¥¼ ì•Œì•„ë³´ê¸° ì „ì— ìš°ì„  ESKF(Error state Kalman Filter)ê°€ ë¬´ì—‡ì¸ì§€ í•œë²ˆ ì•Œì•„ë³´ì.  

ESKF(Error state Kalman Filter)ëŠ” ê¸°ì¡´ì˜ EKF(Extended Kalman Filter)ì™€ Inputê³¼ Outputì´ ì‚´ì§ ë‹¤ë¥´ê³ , ì „ì²´ì ì¸ êµ¬ì¡°ëŠ” ë¹„ìŠ·í•˜ë‹¤ê³  ì´í•´í–ˆë‹¤.  

<u>ES-EKFë¼ê³ ë„ í‘œí˜„í•˜ê¸°ë„ í•˜ëŠ”ë° ì´ í¬ìŠ¤íŒ…ì—ì„œëŠ” ESKFë¡œ í†µì¼í•˜ê² ë‹¤.</u>  

ë‘ Filter ëª¨ë‘ stateë¥¼ ë” ì˜ êµ¬í•˜ëŠ” ê²ƒì´ ëª©í‘œì¸ë°, EKFì˜ ê²½ìš° state ìì²´ë¥¼ êµ¬í•˜ëŠ” ê²ƒì´ ëª©ì ì´ê³ , ESKFì˜ ê²½ìš° ì´ì „ stateì™€ predict stateì˜ Error term stateë¥¼ 0ìœ¼ë¡œ ë§Œë“œëŠ” ê²ƒì´ ëª©ì ì´ë‹¤!  

ë§ë¡œë§Œ ì„¤ëª…ì„ í•˜ëŠ” ê²ƒë³´ë‹¤ ìˆ˜ì‹ì„ ë³´ë©´ì„œ ì´í•´ë¥¼ í•˜ëŠ” ê²ƒì´ í›¨ì”¬ ë¹ ë¥´ë‹¤ê³  ìƒê°í•œë‹¤.  

EKF(Extended Kalman Filter)ì— ëŒ€í•œ ìˆ˜ì‹ì€ ì•„ë˜ì™€ ê°™ë‹¤.  

<p align="center"><img src="https://user-images.githubusercontent.com/41863759/176094891-3de3ffb7-ff10-458c-b4b9-5b1db9212b08.png" width = "550" ></p>  

Inputìœ¼ë¡œëŠ” ì´ì „ stateë¥¼ ê°€ìš°ì‹œì•ˆ ë¶„í¬ë¡œ ëª¨ë¸ë§í•œ $\mu_{t-1}$, control input $u$, measurement $z$, Covaraince Matrix $P_{t-1}$ì´ ë“¤ì–´ê°„ë‹¤. ê·¸ë¦¬ê³  EKFë¥¼ í†µí•´ ë‚˜ì˜¤ëŠ” ê°’ì€ í˜„ì¬ stateë¥¼ ê°€ìš°ì‹œì•ˆ ë¶„í¬ë¡œ ëª¨ë¸ë§í•œ $\mu_{t}$, Covaraince Matrix $P_{t}$ì´ë‹¤.  

ESKF(Error state Kalman Filter)ì— ëŒ€í•œ ìˆ˜ì‹ì„ ë³´ë©´ ì•„ë˜ì™€ ê°™ë‹¤.  

<p align="center"><img src="https://user-images.githubusercontent.com/41863759/176095955-658507e2-d5c6-4d01-b1f6-c0bec0fab45c.png" width = "650" ></p>  

ì–¸ëœ» ë³´ë©´, ì°¨ì´ì ì´ ë³„ë¡œ ì—†ì–´ë³´ì¸ë‹¤. ë™ì¼í•˜ê²Œ Prediction stepê³¼ Update stepì„ ìˆ˜í–‰í•˜ëŠ”ë° stateë¥¼ ê°€ìš°ì‹œì•ˆ ë¶„í¬ë¡œ ëª¨ë¸ë§(Linearization)í•˜ëŠ” ëŒ€ì‹ , state vector $s_t$ë¥¼ êµ¬í•˜ëŠ”ë° ì‚¬ìš©í•˜ëŠ” function $f$ë¥¼ non-linear functionì„ ê·¸ëŒ€ë¡œ ì‚¬ìš©í•˜ê³  $e_t = \mu_t - \mu_{t-1}$ ì´ë¼ëŠ” error termì„ Linearizationì„ ìˆ˜í–‰í•˜ê²Œ ëœë‹¤.  

ì—¬ê¸°ì„œ ì‚¬ìš©í•˜ëŠ” Covaraince Matrix $P_{t}$ ë˜í•œ error termì— ëŒ€í•œ Covaraince matrixì´ë‹¤.  

ë˜ ë‹¤ë¥¸ ê·¸ë¦¼ì„ í†µí•´ Error state Kalman Filterë¥¼ ì´í•´í•´ë³´ì.  

<p align="center"><img src="https://user-images.githubusercontent.com/41863759/176097421-f028fa48-1e8d-47ef-92b0-4b79a87dacfb.png" width = "400" ></p>  

ìš°ë¦¬ê°€ ì¶”ì •í•˜ê³  ì‹¶ì€ stateê°€ true state $x$ë¼ê³  í•  ë•Œ, EKFì˜ ê²½ìš° ì´ stateë¥¼ í•œë²ˆì— ì„ í˜•í™”(Linearization)ì„ ì§„í–‰í•˜ëŠ” ë°˜ë©´, ESKFì˜ ê²½ìš° True stateì™€ Nominal stateì˜ ì°¨ì´ë¥¼ ì¤„ì´ëŠ” error termì„ ì„ í˜•í™”(Linearization)ì„ ì§„í–‰í•œë‹¤.  

Nominal stateë€ Motion modelì„ ì‚¬ìš©í•˜ì—¬ ì˜ˆì¸¡í•œ stateë¼ê³  ìƒê°í•˜ë©´ ëœë‹¤.  


**ì •ë¦¬ë¥¼ í•´ë³´ìë©´ ë‹¤ìŒê³¼ ê°™ë‹¤.**  
- ESKFëŠ” state vector ìì²´ë¥¼ ì„ í˜•í™”í•˜ê³  ì˜ˆì¸¡í•˜ëŠ” ëŒ€ì‹ , error termì„ 0ìœ¼ë¡œ ë§Œë“œëŠ” ê²ƒì´ ëª©ì ì´ë‹¤.  
- ESKFëŠ” EKFì™€ ë™ì¼í•˜ê²Œ Prediction stepê³¼ Update stepì„ ê±°ì¹œë‹¤.  
- ESKFì—ì„œì˜ Covariance matrixëŠ” error termì— ëŒ€í•œ Covariance Matrixì´ë‹¤.  

## Error state Kalman Filterì˜ ì¥ì   

EKFë³´ë‹¤ ESKFê°€ ê°€ì§€ê³  ìˆëŠ” ì¥ì ì´ ë¬´ì—‡ì¼ê¹Œ?  

ê²°ë¡ ì ìœ¼ë¡œ ë‘ ê°€ì§€ë¥¼ ì´ì•¼ê¸°í•˜ê³  ìˆëŠ”ë°  

1. State vector ìì²´ë¥¼ predict & updateí•˜ëŠ” ê²ƒë³´ë‹¤ Error termë§Œì„ í™œìš©í•´ì„œ predict & updateí•˜ëŠ” ê²ƒì´ ì„ í˜•í™”(linearize)ê°€ ë” ì˜ëœë‹¤.  
2. ìµœì í™”ë¥¼ í•  ë•Œ Rotation(=orientation)ì„ ìµœì í™” í•˜ëŠ” ê²ƒì´ ì œì•½ì¡°ê±´(Constraints)ì´ ë§ì€ë° Error term ìì²´ê°€ ê°’ì´ ì‘ìœ¼ë¯€ë¡œ ì œì•½ì¡°ê±´ì—ì„œ ë¹„êµì  ììœ ë¡œìš¸ ìˆ˜ ìˆë‹¤.  

Referenceë¥¼ ì°¸ê³ í•´ë³´ë©´, í•­ê³µìª½ì—ì„œ state estimationì„ í•  ë•Œì™€, IMUì™€ ê°™ì´ measurementê°€ ë¹ ë¥´ê²Œ ë“¤ì–´ì˜¬ ë•Œ, Error state Kalman Filterë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒ ê°™ì•˜ë‹¤.  

ìì„¸í•œ ë‚´ìš©ì€ ì•„ë˜ì˜ ë§í¬ë¥¼ ì°¸ê³ í•´ë³´ì.  

- [Quaternion kinematics for the error-state Kalman filter](https://www.iri.upc.edu/people/jsola/JoanSola/objectes/notes/kinematics.pdf) ì˜ Chapter 5  
- [Extended Kalman Filter vs. Error State Kalman Filter for Aircraft Attitude Estimation](https://arc.aiaa.org/doi/10.2514/6.2011-6615)  

## Iterated error state Kalman Filterë€?  

ì´ë¦„ì—ì„œë„ ì•Œ ìˆ˜ ìˆëŠ”ë°, Error state Kalman Filterë¥¼ iterativeí•˜ê²Œ ì‚¬ìš©í•˜ëŠ” ë°©ë²•ì´ë‹¤.  

ì‚¬ì‹¤ Error state Kalman Filterë¥¼ ì´í•´í–ˆë‹¤ë©´ Iterated error state Kalman Filterë¥¼ ì´í•´í•˜ëŠ” ê²ƒì€ ë¹„êµì  ì‰½ë‹¤! Error state Kalman Filterì˜ ëª©ì ì´ error termì„ 0ìœ¼ë¡œ ë§Œë“œëŠ” ê²ƒì´ë¯€ë¡œ, (ì»´í“¨íŒ… íŒŒì›Œê°€ í—ˆë½í•œë‹¤ë©´) ë°˜ë³µì ìœ¼ë¡œ Update stepì„ ì§„í–‰í•˜ì—¬ error termì„ 0ìœ¼ë¡œ ë§Œë“œëŠ” ê²ƒì´ë‹¤.  

ì•„ë˜ëŠ” Error state Kalman Filterì™€ Iterated error state Kalman Filterì˜ ì°¨ì´ì ì„ ë‚˜íƒ€ë‚¸ ê²ƒì´ë‹¤.  

<p align="center"><img src="https://user-images.githubusercontent.com/41863759/176100858-bb13d0ce-3706-4c5f-ac4f-4c90d0a75c86.png" width = "500" ></p>  

<p align="center"><img src="https://user-images.githubusercontent.com/41863759/176100871-47060049-59e2-493d-8728-ec652c55c748.png" width = "500" ></p>  

Iterated error state Kalman Filterì˜ ê²½ìš° update stepì„ ì—¬ëŸ¬ë²ˆ ì§„í–‰í•˜ê¸° ë•Œë¬¸ì— ê¸°ì¡´ì˜ Error state Kalman Filterë³´ë‹¤ ê³„ì‚°ëŸ‰ì´ ë§ì§€ë§Œ, ì›í•˜ëŠ” ê²°ê³¼ì— ì¢€ ë” ì •í™•í•˜ê²Œ ë„ë‹¬í•  ìˆ˜ ìˆë‹¤ëŠ” ì¥ì ì´ ìˆë‹¤.  

---

ì´ë ‡ê²Œ í•´ì„œ Iterated error state Kalman Filterì— ëŒ€í•œ í¬ìŠ¤íŒ…ì„ ë§ˆë¬´ë¦¬ í•˜ê² ë‹¤. ì•„ë˜ì—ëŠ” í¬ìŠ¤íŒ…ì„ ì‘ì„±í•˜ë©´ì„œ ì°¸ê³ í•œ ìë£Œë“¤ì´ë‹¤. ğŸ˜†ğŸ˜†  

## Refernce  

- [A â€œquickâ€ review of Error State - Extended Kalman Filter](https://notanymike.github.io/Error-State-Extended-Kalman-Filter/)  
- [Coursera Lesson 4: An Improved EKF - The Error State Extended Kalman Filter](https://www.coursera.org/lecture/state-estimation-localization-self-driving-cars/lesson-4-an-improved-ekf-the-error-state-extended-kalman-filter-7Nwfw?utm_source=link&utm_medium=page_share&utm_content=vlp&utm_campaign=top_button)  
- [Quaternion kinematics for the error-state Kalman filter](https://www.iri.upc.edu/people/jsola/JoanSola/objectes/notes/kinematics.pdf)  
- [Extended Kalman Filter vs. Error State Kalman Filter for Aircraft Attitude Estimation](https://arc.aiaa.org/doi/10.2514/6.2011-6615)  